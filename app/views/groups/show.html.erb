<!-- Group Show Page Layout -->
<div class="container mt-5">
  <!-- Back to Memberships Link -->
  <div class="mb-4 d-flex justify-content-between align-items-center">
    <%= link_to "â† Back to Your Groups", memberships_path, class: "text-decoration-none fw-bold text-primary" %>
    <% if current_user == @group.creator %>
      <%= link_to "Edit Group", edit_group_path(@group), class: "btn btn-outline-secondary" %>
    <% end %>
  </div>

  <!-- Group Header -->
  <h2 class="text-center fw-bold" style="font-family: 'Cinzel Decorative', serif;">
    <%= @group.name %>
  </h2>

  <!-- User List (Clickable Icons) -->
  <div class="mt-5 mb-4">
    <label class="form-label fw-bold" style="font-family: 'Cinzel Decorative', serif;">Group Members:</label>
    <div class="d-flex flex-wrap gap-3">
      <% @group.users.each do |user| %>
        <div class="text-center">
          <%= link_to user_chat_path(user), remote: true do %>
            <%= image_tag(user.image.attached? ? user.image.variant(resize_to_limit: [50, 50]) : "default-avatar.jpeg", class: "rounded-circle", style: "width: 50px; height: 50px; object-fit: cover;") %>
            <div class="small mt-1 fw-semibold"><%= user.email.split('@').first.titleize %></div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Real-Time Group Chat -->
  <div class="mt-5">
    <label class="form-label fw-bold" style="font-family: 'Cinzel Decorative', serif;">Group Chat</label>

    <div id="group-chat-window" class="border rounded p-3 mb-3" style="height: 300px; overflow-y: scroll; background-color: #f8f9fa;">
      <%= turbo_frame_tag "group_messages" do %>
        <%= render partial: "messages/group_chat", locals: { group: @group } %>
      <% end %>
    </div>

    <%= form_with model: Message.new, url: group_messages_path(@group), method: :post, data: { turbo_stream: true }, html: { id: "group-message-form" } do |form| %>
      <%= form.hidden_field :sender_id, value: current_user.id %>
      <%= form.hidden_field :group_id, value: @group.id %>
      <%= form.hidden_field :original_language_id, value: current_user.preferred_language_id %>
      <div class="input-group">
        <%= form.text_field :body, class: "form-control", placeholder: "Type your message...", autofocus: true %>
        <button type="submit" class: "btn btn-primary">Send</button>
      </div>
    <% end %>
  </div>
</div>

<!-- Turbo Stream auto-updates -->
<%= turbo_stream_from "group_#{@group.id}_messages" %>
