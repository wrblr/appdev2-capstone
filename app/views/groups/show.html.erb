<!-- Group Show Page Layout -->
<div class="container mt-5 p-4 bg-white rounded shadow-sm" style="max-width: 800px;">
  <!-- Back to Memberships Link -->
  <div class="mb-4 d-flex justify-content-between align-items-center">
    <%= link_to "â† Back to Your Groups", memberships_path, class: "text-decoration-none fw-bold text-primary" %>
    <% if current_user == @group.creator %>
      <%= link_to "Edit Group", edit_group_path(@group), class: "btn btn-outline-secondary" %>
    <% end %>
  </div>

  <!-- Group Header -->
  <div class="text-center mb-4">
    <h2 class="fw-bold" style="font-family: 'Cinzel Decorative', serif;">
      <%= @group.name %>
    </h2>
  </div>

  <!-- User List (Clickable Icons) -->
  <div class="mt-4 mb-5 text-center">
    <label class="form-label fw-bold" style="font-family: 'Cinzel Decorative', serif;">Group Members:</label>
    <div class="d-flex justify-content-center flex-wrap gap-4 mt-3">
      <% @group.users.each do |user| %>
        <div class="text-center">
          <%= link_to chat_user_path(user), remote: true do %>
            <%= image_tag(user.image.attached? ? user.image.variant(resize_to_limit: [60, 60]) : "default-avatar.jpeg", class: "rounded-circle border", style: "width: 60px; height: 60px; object-fit: cover;") %>
            <div class="small mt-1 fw-semibold"><%= user.email.split('@').first.titleize %></div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Group Chat Section Polished -->
  <div class="mt-4">
    <div class="text-center mb-4">
      <h3 class="fw-bold" style="font-family: 'Cinzel Decorative', serif;">Group Chat</h3>
      <p class="text-muted">Talk with your group in real time</p>
    </div>

    <div id="group-chat-window" class="border rounded p-4 mb-3" style="height: 300px; overflow-y: scroll; background-color: #f8f9fa;">
      <%= turbo_frame_tag "group_messages" do %>
        <%= render partial: "messages/group_chat", locals: { group: @group } %>
      <% end %>
    </div>

    <%= form_with model: Message.new, url: group_messages_path(@group), method: :post, data: { turbo_stream: true }, html: { id: "group-message-form" } do |form| %>
      <%= form.hidden_field :sender_id, value: current_user.id %>
      <%= form.hidden_field :group_id, value: @group.id %>
      <%= form.hidden_field :original_language_id, value: current_user.preferred_language_id %>

      <div class="input-group">
        <%= form.text_field :body, class: "form-control", placeholder: "Type your message...", autofocus: true %>
        <button type="submit" class="btn btn-primary">Send</button>
      </div>
    <% end %>
  </div>
</div>

<!-- Turbo Stream auto-updates -->
<%= turbo_stream_from "group_#{@group.id}_messages" %>
