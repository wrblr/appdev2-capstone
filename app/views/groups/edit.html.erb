<% content_for :title, "Editing group" %>

<h1>Editing group</h1>

<%= render "form", group: @group %>

<br>

<div>
  <%= link_to "Show this group", @group %> |
  <%= link_to "Back to groups", groups_path %>
</div>

<hr>

<h1 class="text-center fw-bold mb-5" style="font-family: 'Cinzel Decorative', serif;">Edit Group</h1>

<%= form_with model: @group, local: true do |form| %>
  <% if @group.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(@group.errors.count, "error") %> prevented this group from being saved:</h4>
      <ul>
        <% @group.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- Group Name -->
  <div class="mb-4">
    <%= form.label :name, "Group Name", class: "form-label fw-bold" %>
    <%= form.text_field :name, class: "form-control", placeholder: "Enter group name" %>
  </div>

  <!-- Group Image -->
  <div class="mb-4">
    <%= form.label :image, "Group Image", class: "form-label fw-bold" %>
    <%= form.file_field :image, class: "form-control" %>

    <% if @group.image.attached? %>
      <div class="mt-3">
        <p class="fw-bold">Current Image:</p>
        <%= image_tag @group.image.variant(resize_to_limit: [200, 200]), class: "img-thumbnail" %>

        <div class="mt-2">
          <%= button_to "Remove Image", remove_image_group_path(@group), method: :delete, data: { confirm: "Are you sure?" }, class: "btn btn-outline-danger btn-sm" %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Submit -->
  <div class="text-center mt-5">
    <%= form.submit "Update Group", class: "btn btn-primary px-4 fw-bold" %>
  </div>
<% end %>

<!-- Members List -->
<h2 class="mt-5 mb-3 fw-bold" style="font-family: 'Cinzel Decorative', serif;">Group Members</h2>
<div class="d-flex flex-wrap gap-4">
  <% @group.users.each do |user| %>
    <div class="text-center">
      <%= image_tag user.avatar.variant(resize_to_fill: [80, 80]), class: "rounded-circle shadow", alt: user.name if user.avatar.attached? %>
      <p class="mt-2 fw-semibold"><%= user.name %></p>
    </div>
  <% end %>
</div>

<!-- Delete Group -->
<div class="text-center mt-5">
  <%= button_to "Delete Group", group_path(@group), method: :delete, data: { confirm: "Are you sure you want to delete this group?" }, class: "btn btn-danger fw-bold" %>
</div>
