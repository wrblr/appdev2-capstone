<div class="container mt-4 mb-3 p-4 bg-white rounded shadow-sm" style="max-width: 800px; height: 600px">
  <div class="mt-4">
    <%= link_to "â† Back to Your Groups", memberships_path, class: "btn btn-link fw-bold", style: "font-family: 'Cinzel Decorative', serif;" %>
    <div class="text-center mb-4">
      <h3 class="fw-bold" style="font-family: 'Cinzel Decorative', serif;">Chat with <%= @recipient.email.split('@').first.titleize %></h3>
      <p class="text-muted" style="font-family: 'Cinzel Decorative', serif;">Private chat: Talk with your friend in real time</p>
    </div>

    <div id="private-chat-window" class="border rounded p-4 mb-3" style="height: 300px; overflow-y: scroll; background-color: #f8f9fa;">
      <%= turbo_frame_tag "private-chat-window" do %>
        <%= render partial: "messages/private_chat", locals: {
        current_user: current_user,
        recipient: @recipient,
        messages: @messages
      } %>
      <% end %>
    </div>

    <%= form_with model: @message,
              url: chat_user_messages_path(current_user.id, @recipient.id),
              method: :post,
              data: { turbo_stream: true },
              html: { id: "private-message-form", class: "flex gap-2" } do |form| %>

      <%= form.hidden_field :sender_id, value: current_user.id %>
      <%= form.hidden_field :recipient_id, value: @recipient.id %>
      <%= form.hidden_field :original_language_id, value: current_user.preferred_language_id %>

      <div class="input-group">
        <%= form.text_field :body,
                      placeholder: "Type your message...",
                      class: "form-control",
                      style: "font-family: 'Cinzel Decorative', serif;",
                      autofocus: true %>
        <button type="submit" class="btn btn-primary" style="font-family: 'Cinzel Decorative', serif;">Send</button>
      </div>
    <% end %>
  </div>
</div>

<%= turbo_stream_from "private_chat_#{[current_user.id, @recipient.id].sort.join('_')}_messages" %>
