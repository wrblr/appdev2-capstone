<!--<p style="color: green"><%#= notice %></p>

<%#= render @message %>-->
<!--
<div>
  <%#= link_to "Edit this message", edit_message_path(@message) %> |-->
<%#= link_to "Back to messages", messages_path %>
<!---->
<%#= button_to "Destroy this message", @message, method: :delete %>
<!--</div>

<%#= link_to user_chat_path(user), remote: true do %>-->
<!--
  <hr>-->

<h3>Chat with <%= @recipient.email %></h3>

<div id="private-chat-window" style="height: 300px; overflow-y: scroll;" class="border rounded p-3 mb-3">
  <% @messages.each do |message| %>
    <p><strong><%= message.sender == current_user ? 'You' : @recipient.email.split('@').first.titleize %>:</strong> <%= message.content %></p>
  <% end %>
</div>

<%= form_with model: Message.new, url: group_messages_path(@group), data: { turbo_stream: true }, html: { id: "group-message-form" } do |form| %>
  <%= form.hidden_field :sender_id, value: current_user.id %>
  <%= form.hidden_field :original_language_id, value: current_user.preferred_language_id %>
  <%= form.hidden_field :group_id, value: @group.id %>
  <%= form.text_field :body, class: "form-control", placeholder: "Type your message..." %>

  <div class="input-group">
    <%= form.text_field :body, class: "form-control", placeholder: "Type your message...", autofocus: true %>
    <button type="submit" class="btn btn-primary">Send</button>
  </div>
<% end %>

<hr>

<!-- Private User Chat Page Layout -->
<div class="container mt-5 p-4 bg-white rounded shadow-sm" style="max-width: 800px;">
  <!-- Back to Memberships Link -->
  <div class="mb-4 d-flex justify-content-between align-items-center">
    <%= link_to "â† Back to Your Groups", memberships_path, class: "text-decoration-none fw-bold text-primary" %>
  </div>

  <!-- Header -->
  <div class="text-center mb-4">
    <h2 class="fw-bold" style="font-family: 'Cinzel Decorative', serif;">
      Private Chat with <%= @recipient.email.split('@').first.titleize %>
    </h2>
  </div>

  <!-- Chat Section -->
  <div class="mt-4">
    <div class="text-center mb-4">
      <h3 class="fw-bold" style="font-family: 'Cinzel Decorative', serif;">Direct Messages</h3>
      <p class="text-muted">Private conversation between you and <%= @recipient.email.split('@').first.titleize %></p>
    </div>

    <div id="private-chat-window" class="border rounded p-4 mb-3" style="height: 300px; overflow-y: scroll; background-color: #f8f9fa;">
      <%= turbo_frame_tag "user_messages" do %>
        <%= render partial: "messages/user_chat", locals: { messages: @messages } %>
      <% end %>
    </div>

    <%= form_with model: Message.new, url: user_messages_path(@recipient), method: :post, data: { turbo_stream: true }, html: { id: "user-message-form" } do |form| %>
      <%= form.hidden_field :sender_id, value: current_user.id %>
      <%= form.hidden_field :recipient_id, value: @recipient.id %>
      <%= form.hidden_field :original_language_id, value: current_user.language_id %>

      <div class="input-group">
        <%= form.text_field :body, class: "form-control", placeholder: "Type your message...", autofocus: true %>
        <button type="submit" class="btn btn-primary">Send</button>
      </div>
    <% end %>
  </div>
</div>

<!-- Turbo Stream auto-updates -->
<%= turbo_stream_from "user_#{[current_user.id, @recipient.id].sort.join('_')}_messages" %>
