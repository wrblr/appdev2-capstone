<h1 class="fw-bold text-center" style="font-family: 'Cinzel Decorative', serif;">Start a New Private Chat</h1>

<%= form_with url: "#", method: :get, local: true, id: "start-private-chat-form" do |form| %>
  <div class="mb-3">
    <%= label_tag :recipient_id, "Select a user:", class: "form-label fw-bold", style: "font-family: 'Cinzel Decorative', serif;" %>
    <%= select_tag :recipient_id,
        options_from_collection_for_select(@users, :id, ->(u) { u.email.split('@').first.titleize }),
        prompt: "Choose a user...",
        class: "form-select",
        style: "font-family: 'Cinzel Decorative', serif;" %>
  </div>

  <%= submit_tag "Start Chat", class: "btn btn-primary", style: "font-family: 'Cinzel Decorative', serif;" %>
<% end %>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    document.getElementById("start-private-chat-form").addEventListener("submit", function (event) {
      event.preventDefault();
      const recipientId = document.getElementById("recipient_id").value;
      if (recipientId) {
        const senderId = <%= current_user.id %>;
        window.location.href = `/messages/${senderId}/${recipientId}`;
      }
    });
  });
</script>
